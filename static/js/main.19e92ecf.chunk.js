(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{107:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.renderData=t.renderValue=t.ValueViewer=t.DataEditor=t.Cell=t.Row=t.Sheet=void 0;var a=s(n(139)),r=s(n(71)),o=s(n(72)),i=s(n(53)),l=s(n(54)),c=s(n(55)),u=n(74);function s(e){return e&&e.__esModule?e:{default:e}}t.default=a.default,t.Sheet=r.default,t.Row=o.default,t.Cell=i.default,t.DataEditor=l.default,t.ValueViewer=c.default,t.renderValue=u.renderValue,t.renderData=u.renderData},115:function(e,t,n){e.exports=n(262)},120:function(e,t,n){},127:function(e,t,n){},139:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(0),i=b(o),l=b(n(11)),c=b(n(71)),u=b(n(72)),s=b(n(53)),d=b(n(140)),f=b(n(54)),p=b(n(55)),h=n(73);function b(e){return e&&e.__esModule?e:{default:e}}var m=function(e){return 0===Object.keys(e).length},v=function(e,t){for(var n=[],a=t-e>0,r=e;a?r<=t:r>=t;a?r++:r--)a?n.push(r):n.unshift(r);return n},y=function(e){return e.split(/\r\n|\n|\r/).map(function(e){return e.split("\t")})},g=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onMouseDown=n.onMouseDown.bind(n),n.onMouseUp=n.onMouseUp.bind(n),n.onMouseOver=n.onMouseOver.bind(n),n.onDoubleClick=n.onDoubleClick.bind(n),n.onContextMenu=n.onContextMenu.bind(n),n.handleNavigate=n.handleNavigate.bind(n),n.handleKey=n.handleKey.bind(n).bind(n),n.handleCut=n.handleCut.bind(n),n.handleCopy=n.handleCopy.bind(n),n.handlePaste=n.handlePaste.bind(n),n.pageClick=n.pageClick.bind(n),n.onChange=n.onChange.bind(n),n.onRevert=n.onRevert.bind(n),n.isSelected=n.isSelected.bind(n),n.isEditing=n.isEditing.bind(n),n.isClearing=n.isClearing.bind(n),n.handleComponentKey=n.handleComponentKey.bind(n),n.handleKeyboardCellMovement=n.handleKeyboardCellMovement.bind(n),n.defaultState={start:{},end:{},selecting:!1,forceEdit:!1,editing:{},clear:{}},n.state=n.defaultState,n.removeAllListeners=n.removeAllListeners.bind(n),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.PureComponent),r(t,[{key:"removeAllListeners",value:function(){document.removeEventListener("mousedown",this.pageClick),document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("cut",this.handleCut),document.removeEventListener("copy",this.handleCopy),document.removeEventListener("paste",this.handlePaste)}},{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){this.removeAllListeners()}},{key:"isSelectionControlled",value:function(){return"selected"in this.props}},{key:"getState",value:function(){var e=this.state;if(this.isSelectionControlled()){var t=this.props.selected||{},n=t.start,r=t.end;n=n||this.defaultState.start,r=r||this.defaultState.end,e=a({},e,{start:n,end:r})}return e}},{key:"_setState",value:function(e){if(this.isSelectionControlled()&&("start"in e||"end"in e)){var t=e.start,n=e.end,a=function(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}(e,["start","end"]),r=this.props,o=r.selected,i=r.onSelect;o=o||{},t||(t="start"in o?o.start:this.defaultState.start),n||(n="end"in o?o.end:this.defaultState.end),i&&i({start:t,end:n}),this.setState(a)}else this.setState(e)}},{key:"pageClick",value:function(e){this.dgDom.contains(e.target)||(this.setState(this.defaultState),this.removeAllListeners())}},{key:"handleCut",value:function(e){if(m(this.state.editing)){e.preventDefault(),this.handleCopy(e);var t=this.getState(),n=t.start,a=t.end;this.clearSelectedCells(n,a)}}},{key:"handleCopy",value:function(e){if(m(this.state.editing)){e.preventDefault();var t=this.props,n=t.dataRenderer,a=t.valueRenderer,r=t.data,o=this.getState(),i=o.start,l=o.end,c=v(i.i,l.i).map(function(e){return v(i.j,l.j).map(function(t){var o=r[e][t],i=n?n(o,e,t):null;return""===i||null===i||"undefined"===typeof i?a(o,e,t):i}).join("\t")}).join("\n");e.clipboardData.setData("text/plain",c)}}},{key:"handlePaste",value:function(e){if(m(this.state.editing)){var t=this.getState(),n=t.start,a=t.end;n={i:Math.min(n.i,a.i),j:Math.min(n.j,a.j)},a={i:Math.max(n.i,a.i),j:Math.max(n.j,a.j)};var r=this.props.parsePaste||y,o=[],i=r(e.clipboardData.getData("text/plain")),l=this.props,c=l.data,u=l.onCellsChanged,s=l.onPaste,d=l.onChange;if(u){var f=[];i.forEach(function(e,t){e.forEach(function(e,r){a={i:n.i+t,j:n.j+r};var i=c[a.i]&&c[a.i][a.j];i?i.readOnly||o.push({cell:i,row:a.i,col:a.j,value:e}):f.push({row:a.i,col:a.j,value:e})})}),f.length?u(o,f):u(o)}else s?(i.forEach(function(e,t){var r=[];e.forEach(function(e,o){a={i:n.i+t,j:n.j+o};var i=c[a.i]&&c[a.i][a.j];r.push({cell:i,data:e})}),o.push(r)}),s(o)):d&&i.forEach(function(e,t){e.forEach(function(e,r){a={i:n.i+t,j:n.j+r};var o=c[a.i]&&c[a.i][a.j];o&&!o.readOnly&&d(o,a.i,a.j,e)})});this._setState({end:a})}}},{key:"handleKeyboardCellMovement",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log("handleKeyboardCellMovement");var n=this.getState(),a=n.start,r=n.editing,o=this.props.data,i=r&&!m(r),l=o[a.i]&&o[a.i][a.j];if(i&&!t)return!1;var c=l&&l.component,u=e.which||e.keyCode;c&&i?e.preventDefault():u===h.TAB_KEY?this.handleNavigate(e,{i:0,j:e.shiftKey?-1:1},!0):u===h.RIGHT_KEY?this.handleNavigate(e,{i:0,j:1}):u===h.LEFT_KEY?this.handleNavigate(e,{i:0,j:-1}):u===h.UP_KEY?this.handleNavigate(e,{i:-1,j:0}):u===h.DOWN_KEY?this.handleNavigate(e,{i:1,j:0}):t&&u===h.ENTER_KEY&&this.handleNavigate(e,{i:e.shiftKey?-1:1,j:0})}},{key:"handleKey",value:function(e){if(console.log("DataSheet.handleKey"),!e.isPropagationStopped||!e.isPropagationStopped()){var t=e.which||e.keyCode,n=this.getState(),a=n.start,r=n.end,o=n.editing,i=o&&!m(o),l=!a||m(a),c=e.ctrlKey||e.metaKey,u=t===h.DELETE_KEY||t===h.BACKSPACE_KEY,s=t===h.ENTER_KEY,d=t>=48&&t<=57,f=t>=65&&t<=90,p=t>=160&&t<=255,b=t>=96&&t<=105,v=!l&&this.props.data[a.i][a.j],y=[187,189,190,107,109,110].indexOf(t)>-1;if(l||c)return!0;i||(this.handleKeyboardCellMovement(e),u?(e.preventDefault(),this.clearSelectedCells(a,r)):v&&!v.readOnly&&(s?(this._setState({editing:a,clear:{},forceEdit:!0}),e.preventDefault()):(d||b||f||p||y)&&this._setState({editing:a,clear:a,forceEdit:!1})))}}},{key:"getSelectedCells",value:function(e,t,n){var a=[];return v(t.i,n.i).map(function(r){v(t.j,n.j).map(function(t){e[r]&&e[r][t]&&a.push({cell:e[r][t],row:r,col:t})})}),a}},{key:"clearSelectedCells",value:function(e,t){var n=this,r=this.props,o=r.data,i=r.onCellsChanged,l=r.onChange,c=this.getSelectedCells(o,e,t).filter(function(e){return!e.cell.readOnly}).map(function(e){return a({},e,{value:""})});i?(i(c),this.onRevert()):l&&setTimeout(function(){c.forEach(function(e){var t=e.cell,n=e.row,a=e.col,r=e.value;l(t,n,a,r)}),n.onRevert()},0)}},{key:"handleNavigate",value:function(e,t,n){var a=this;if(t&&(t.i||t.j)){var r=this.getState().start,o=this.props.data,i={i:r.i+t.i,j:r.j+t.j},l=function(){return!(!o[i.i]||"undefined"===typeof o[i.i][i.j])&&(a._setState({start:i,end:i,editing:{}}),e.preventDefault(),!0)};!l()&&n&&(i=t.j<0?{i:r.i-1,j:o[0].length-1}:{i:r.i+1,j:0},l())}}},{key:"handleComponentKey",value:function(e){var t=this;console.log("handle component key");var n=e.which||e.keyCode;if([h.ENTER_KEY,h.ESCAPE_KEY,h.TAB_KEY].includes(n)){var a=this.state.editing,r=this.props.data;if(!m(a)){var o=r[a.i][a.j],i=e.shiftKey?-1:1;if(o&&o.component&&!o.forceComponent){e.preventDefault();var l=this.onRevert;n===h.ENTER_KEY?l=function(){return t.handleNavigate(e,{i:i,j:0})}:n===h.TAB_KEY&&(l=function(){return t.handleNavigate(e,{i:0,j:i},!0)}),setTimeout(function(){l(),t.dgDom&&t.dgDom.focus()},1)}}}}},{key:"onContextMenu",value:function(e,t,n){var a=this.props.data[t][n];this.props.onContextMenu&&this.props.onContextMenu(e,a,t,n)}},{key:"onDoubleClick",value:function(e,t){this.props.data[e][t].readOnly||this._setState({editing:{i:e,j:t},forceEdit:!0,clear:{}})}},{key:"onMouseDown",value:function(e,t){var n=m(this.state.editing)||this.state.editing.i!==e||this.state.editing.j!==t?{}:this.state.editing;this._setState({selecting:!0,start:{i:e,j:t},end:{i:e,j:t},editing:n,forceEdit:!1}),document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("mousedown",this.pageClick),document.addEventListener("cut",this.handleCut),document.addEventListener("copy",this.handleCopy),document.addEventListener("paste",this.handlePaste)}},{key:"onMouseOver",value:function(e,t){this.state.selecting&&m(this.state.editing)&&this._setState({end:{i:e,j:t}})}},{key:"onMouseUp",value:function(){this._setState({selecting:!1}),document.removeEventListener("mouseup",this.onMouseUp)}},{key:"onChange",value:function(e,t,n){var a=this.props,r=a.onChange,o=a.onCellsChanged,i=a.data;o?o([{cell:i[e][t],row:e,col:t,value:n}]):r&&r(i[e][t],e,t,n),this.onRevert()}},{key:"onRevert",value:function(){this._setState({editing:{}}),this.dgDom&&this.dgDom.focus()}},{key:"componentDidUpdate",value:function(e,t){var n=this.state,a=n.start,r=n.end,o=t.end;m(r)||r.i===o.i&&r.j===o.j||this.isSelectionControlled()||this.props.onSelect&&this.props.onSelect({start:a,end:r})}},{key:"isSelected",value:function(e,t){var n=this.getState(),a=n.start,r=n.end,o=t>=a.j&&t<=r.j,i=t<=a.j&&t>=r.j,l=e>=a.i&&e<=r.i,c=e<=a.i&&e>=r.i;return o&&l||i&&l||i&&c||o&&c}},{key:"isEditing",value:function(e,t){return this.state.editing.i===e&&this.state.editing.j===t}},{key:"isClearing",value:function(e,t){return this.state.clear.i===e&&this.state.clear.j===t}},{key:"render",value:function(){var e=this,t=this.props,n=t.sheetRenderer,a=t.rowRenderer,r=t.cellRenderer,o=t.dataRenderer,l=t.valueRenderer,c=t.dataEditor,u=t.valueViewer,s=t.attributesRenderer,f=t.className,p=t.overflow,h=t.data,b=t.keyFn,m=this.state.forceEdit;return i.default.createElement("span",{ref:function(t){e.dgDom=t},tabIndex:"0",className:"data-grid-container",onKeyDown:this.handleKey},i.default.createElement(n,{data:h,className:["data-grid",f,p].filter(function(e){return e}).join(" ")},h.map(function(t,n){return i.default.createElement(a,{key:b?b(n):n,row:n,cells:t},t.map(function(t,a){return i.default.createElement(d.default,{key:t.key?t.key:n+"-"+a,row:n,col:a,cell:t,forceEdit:m,onMouseDown:e.onMouseDown,onMouseOver:e.onMouseOver,onDoubleClick:e.onDoubleClick,onContextMenu:e.onContextMenu,onChange:e.onChange,onRevert:e.onRevert,onNavigate:e.handleKeyboardCellMovement,onKey:e.handleKey,selected:e.isSelected(n,a),editing:e.isEditing(n,a),clearing:e.isClearing(n,a),attributesRenderer:s,cellRenderer:r,valueRenderer:l,dataRenderer:o,valueViewer:u,dataEditor:c,handleComponentKey:e.handleComponentKey})}))})))}}]),t}();t.default=g,g.propTypes={data:l.default.array.isRequired,className:l.default.string,overflow:l.default.oneOf(["wrap","nowrap","clip"]),onChange:l.default.func,onCellsChanged:l.default.func,onContextMenu:l.default.func,onSelect:l.default.func,selected:l.default.shape({start:l.default.shape({i:l.default.number,j:l.default.number}),end:l.default.shape({i:l.default.number,j:l.default.number})}),valueRenderer:l.default.func.isRequired,dataRenderer:l.default.func,sheetRenderer:l.default.func.isRequired,rowRenderer:l.default.func.isRequired,cellRenderer:l.default.func.isRequired,valueViewer:l.default.func,dataEditor:l.default.func,parsePaste:l.default.func,attributesRenderer:l.default.func,keyFn:l.default.func},g.defaultProps={sheetRenderer:c.default,rowRenderer:u.default,cellRenderer:s.default,valueViewer:p.default,dataEditor:f.default}},140:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(0),o=p(r),i=p(n(11)),l=n(73),c=p(n(53)),u=p(n(35)),s=p(n(54)),d=p(n(55)),f=n(74);function p(e){return e&&e.__esModule?e:{default:e}}function h(e){var t=e.cell,n=e.row,a=e.col,r=e.valueRenderer,o=e.dataRenderer;return(0,f.renderData)(t,n,a,r,o)}function b(e){var t=e.cell,n=e.row,a=e.col,r=e.valueRenderer;return(0,f.renderValue)(t,n,a,r)}function m(e){var t="number"===typeof e.width?e.width+"px":e.width;return t?{width:t}:null}var v=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleChange=n.handleChange.bind(n),n.handleCommit=n.handleCommit.bind(n),n.handleRevert=n.handleRevert.bind(n),n.handleKey=n.handleKey.bind(n),n.handleMouseDown=n.handleMouseDown.bind(n),n.handleMouseOver=n.handleMouseOver.bind(n),n.handleContextMenu=n.handleContextMenu.bind(n),n.handleDoubleClick=n.handleDoubleClick.bind(n),n.state={updated:!1,reverting:!1,value:"",committing:!1},n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.PureComponent),a(t,[{key:"componentWillReceiveProps",value:function(e){var t=this;if(b(e)!==b(this.props)&&(this.setState({updated:!0}),this.timeout=setTimeout(function(){return t.setState({updated:!1})},700)),!0===e.editing&&!1===this.props.editing){var n=e.clearing?"":h(e);this.setState({value:n,reverting:!1})}}},{key:"componentDidUpdate",value:function(e){!0!==e.editing||!1!==this.props.editing||this.state.reverting||this.state.committing||this.state.value===h(this.props)||this.props.onChange(this.props.row,this.props.col,this.state.value)}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timeout)}},{key:"handleChange",value:function(e){this.setState({value:e,committing:!1})}},{key:"handleCommit",value:function(e,t){var n=this.props,a=n.onChange,r=n.onNavigate;e!==h(this.props)?(this.setState({value:e,committing:!0}),a(this.props.row,this.props.col,e)):this.handleRevert(),t&&(t.preventDefault(),r(t,!0))}},{key:"handleRevert",value:function(){this.setState({reverting:!0}),this.props.onRevert()}},{key:"handleMouseDown",value:function(e){var t=this.props,n=t.row,a=t.col,r=t.onMouseDown;t.cell.disableEvents||r(n,a)}},{key:"handleMouseOver",value:function(e){var t=this.props,n=t.row,a=t.col,r=t.onMouseOver;t.cell.disableEvents||r(n,a)}},{key:"handleDoubleClick",value:function(e){var t=this.props,n=t.row,a=t.col,r=t.onDoubleClick;t.cell.disableEvents||r(n,a)}},{key:"handleContextMenu",value:function(e){var t=this.props,n=t.row,a=t.col,r=t.onContextMenu;t.cell.disableEvents||r(e,n,a)}},{key:"handleKey",value:function(e){console.log("DataCell.handleKey");var t=e.which||e.keyCode;if(t===l.ESCAPE_KEY)return this.handleRevert();var n=this.props,a=n.cell.component,r=n.forceEdit||!!a;(t===l.ENTER_KEY||t===l.TAB_KEY||!r&&[l.LEFT_KEY,l.RIGHT_KEY,l.UP_KEY,l.DOWN_KEY].includes(t))&&this.handleCommit(this.state.value,e),this.props.handleComponentKey&&this.props.handleComponentKey(e)}},{key:"renderComponent",value:function(e,t){var n=t.component,a=t.readOnly,r=t.forceComponent;if(e&&!a||r)return n}},{key:"renderEditor",value:function(e,t,n,a,r){if(e){var i=t.dataEditor||r||s.default;return o.default.createElement(i,{cell:t,row:n,col:a,value:this.state.value,onChange:this.handleChange,onCommit:this.handleCommit,onRevert:this.handleRevert,onKeyDown:this.handleKey})}}},{key:"renderViewer",value:function(e,t,n,a,r){var i=e.valueViewer||r||d.default,l=(0,f.renderValue)(e,t,n,a);return o.default.createElement(i,{cell:e,row:t,col:n,value:l})}},{key:"render",value:function(){var e=this.props,t=e.row,n=e.col,a=e.cell,r=e.cellRenderer,i=e.valueRenderer,l=e.dataEditor,c=e.valueViewer,u=e.attributesRenderer,s=e.selected,d=e.editing,f=e.onKeyUp,p=this.state.updated,h=this.renderComponent(d,a)||this.renderEditor(d,a,t,n,l)||this.renderViewer(a,t,n,i,c),b=[a.className,"cell",a.overflow,s&&"selected",d&&"editing",a.readOnly&&"read-only",p&&"updated"].filter(function(e){return e}).join(" ");return o.default.createElement(r,{row:t,col:n,cell:a,selected:s,editing:d,updated:p,attributesRenderer:u,className:b,style:m(a),onMouseDown:this.handleMouseDown,onMouseOver:this.handleMouseOver,onDoubleClick:this.handleDoubleClick,onContextMenu:this.handleContextMenu,onKeyUp:f},h)}}]),t}();t.default=v,v.propTypes={row:i.default.number.isRequired,col:i.default.number.isRequired,cell:i.default.shape(u.default).isRequired,forceEdit:i.default.bool,selected:i.default.bool,editing:i.default.bool,clearing:i.default.bool,cellRenderer:i.default.func,valueRenderer:i.default.func.isRequired,dataRenderer:i.default.func,valueViewer:i.default.func,dataEditor:i.default.func,attributesRenderer:i.default.func,onNavigate:i.default.func.isRequired,onMouseDown:i.default.func.isRequired,onMouseOver:i.default.func.isRequired,onDoubleClick:i.default.func.isRequired,onContextMenu:i.default.func.isRequired,onChange:i.default.func.isRequired,onRevert:i.default.func.isRequired},v.defaultProps={forceEdit:!1,selected:!1,editing:!1,clearing:!1,cellRenderer:c.default}},262:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(19),i=n.n(o),l=(n(120),n(2)),c=n(7),u=n(4),s=n(3),d=n(5),f=n(6),p=n(1),h=n.n(p),b=(n(126),n(127),n(128),n(12)),m=n(21),v=n(14),y=n(9),g="TOGGLE_EDIT_MODE",E="NEW_TABLE",w="DEFS_LOADED",j="DELETE_TABLE",O="DELETE_COLUMN",C="UPDATE_DEF",k="UPDATE_DEFS",S={LIST:"CACHE_LIST",SET:"CACHE_SET",NEW:"CACHE_NEW",DEL:"CACHE_DELETE",PUSH:"CACHE_PUSH"};function D(e){return e.cols?String.fromCharCode(65+Object.keys(e.cols).length):"A"}var M=function(){function e(){Object(l.a)(this,e)}return Object(c.a)(e,null,[{key:"nextTableName",value:function(e){for(var t=1,n=Object.keys(e).reduce(function(t,n){return t[e[n].name]=!0,t},{});n["table"+t];)t++;return"table"+t}}]),e}(),_="tables",x="defs",R="previews",N=n(13),T=n.n(N);var P={backgroundColor:"",showLineNumbers:!0,layout:[[""]]};function K(e,t,n,a,r){var o=n||M.nextTableName(t),i=a||T()(),l=T()(),c=Object(y.a)({},P,{name:o,cols:{}});return c.cols[l]={name:"A",id:l},c.layout=[[l]],e.set([x,i],c,r),{type:E,name:i,def:c}}function A(e,t,n){var a=function(e,t){var n=Object(y.a)({},e),a=T()(),r=n.cols||{},o=Object(y.a)({},r,Object(m.a)({},a,{name:D(n),type:""}));return n.cols=o,n.layout[t]=[].concat(Object(v.a)(n.layout[t]),[a]),n}(t,n);return e.set([x,a.id],a),{type:C,def:a}}function I(e,t,n,a){var r=function(e,t,n){var a=Object(y.a)({},e),r=h.a.keys(a.cols).filter(function(e){return e!==t}).reduce(function(e,t){return Object(y.a)({},e,Object(m.a)({},t,a.cols[t]))},{});return a.cols=r,a.layout[n]=a.layout[n].filter(function(e){return e!==t}),a}(t,n,a);return e.set([x],r.id,r),{type:C,def:r}}function L(e,t,n){return e.set(t,n),t.constructor===Array?{type:S.SET,path:["root"].concat(Object(v.a)(t)),val:n}:{type:S.SET,path:["root",t],val:n}}function U(e,t){return e.constructor===Array?{type:S.SET,path:["root"].concat(Object(v.a)(e)),val:t}:{type:S.SET,path:["root",e],val:t}}function Y(e,t){var n=T()();return L(e,[R,n],{id:n,width:50,height:50,x:0,y:0,tableId:t})}var q=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).onTypeChange=function(e){return function(t){var a=t.props,r=[x,a.def.id,"cols",a.id,"type"];n.props.db.set(r,e,n.props.set(r,e))}},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){console.log("----------------------------------------------------");var e=this.props.db;return r.a.createElement(b.Menu,{id:"columnMenu"},r.a.createElement(b.Item,{onClick:this.props.deleteColumn(e)},"delete column"),r.a.createElement(b.Submenu,{label:"type"},r.a.createElement(b.Item,{onClick:this.onTypeChange("")},"none"),r.a.createElement(b.Item,{onClick:this.onTypeChange("link")},"link"),r.a.createElement(b.Item,{onClick:this.onTypeChange("checkbox")},"checkbox"),r.a.createElement(b.Item,{onClick:this.onTypeChange("document")},"document")))}}]),t}(r.a.Component),F=Object(f.b)(function(e){return{db:e.db}},function(e){return{deleteColumn:function(t){return function(n){var a=n.props;return e(I(t,a.def,a.id,a.layoutNb))}},set:function(t){return function(n){return e(U(t,n))}}}})(q),B=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props.db;return r.a.createElement(b.Menu,{id:"tableMenu"},r.a.createElement(b.Item,{onClick:this.props.addColumn(e)},"add column"),r.a.createElement(b.Item,{onClick:this.props.addColumnUnder(e)},"add column under"),r.a.createElement(b.Item,{onClick:function(e){var t=e.props;return console.log(t)}},"test"))}}]),t}(r.a.Component),H=Object(f.b)(function(e){return{db:e.db}},function(e){return{addColumn:function(t){return function(n){var a=n.props;return e(A(t,a.def,a.layoutNb))}},addColumnUnder:function(t){return function(n){var a=n.props;return e(function(e,t){var n=Object(y.a)({},t),a=T()(),r=n.cols||{},o=Object(y.a)({},r,Object(m.a)({},a,{name:D(n),type:""}));return n.cols=o,n.layout[n.layout.length]=[a],e.set([x,n.id],n),{type:C,def:n}}(t,a.def,a.layoutNb))}}}})(B),V=["ui","loading"],X=["ui","route"],W=n(107),z=n.n(W),G=n(108),$=n(28);var J=Object($.DragSource)("col",{beginDrag:function(e){return{columnIndex:e.columnIndex}}},function(e,t){return{connectDragSource:e.dragSource()}}),Q=Object($.DropTarget)("col",{canDrop:function(e,t){var n=t.getItem();return e.columnIndex!==n.columnIndex},drop:function(e,t,n){if(!t.didDrop()){var a=t.getItem().columnIndex,r=e.columnIndex;(0,e.onColumnDrop)(a,r)}}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()&&t.canDrop()}}),Z=(Object($.DragSource)("row",{beginDrag:function(e){return{rowIndex:e.rowIndex}}},function(e,t){return{connectDragSource:e.dragSource(),connectDragPreview:e.dragPreview()}}),Object($.DropTarget)("row",{canDrop:function(e,t){var n=t.getItem();return e.rowIndex!==n.rowIndex},drop:function(e,t,n){if(!t.didDrop()){var a=t.getItem().rowIndex,r=e.rowIndex;(0,e.onRowDrop)(a,r)}}},function(e,t){return{connectDropTarget:e.dropTarget(),isOver:t.isOver()&&t.canDrop()}}),n(48)),ee=n(15),te="mouseAction",ne="drag";function ae(e){return"string"===typeof e?e:h.a.castArray(e).join(".")}var re=function e(t,n){var a=this;Object(l.a)(this,e),this.get=function(e){return h.a.get(a.data,e)},this.load=function(e){if(!a.db)return h.a.castArray(e).forEach(function(e){a.callCallbacks(e,a.get(e))}),null;console.log("loading: "+e),h.a.castArray(e).forEach(function(e){h.a.get(a.componentLoadedMap,e)||a.db.get(e,function(t){h.a.set(a.componentLoadedMap,e,!0),a.set(e,t)})})},this.dispatch=function(e,t){a.db&&a.db.set(e,t),a.set(e,t)},this.unset=function(e){var t=ae(e);console.log("unsetting "+t),a.data=h.a.omit(a.data,[e]);for(var n=t.split("."),r=n.length;r>0;r--)a.callCallbacks(n.slice(0,r),void 0)},this.dispatchDelete=function(e){a.db&&a.db.unset(e),a.unset(e)},this.dispatchUpdate=function(e,t){a.db&&a.db.update(e,t),h.a.keys(t).forEach(function(n){a.set(ae(e)+"."+n,t[n])})},this.callCallbacks=function(e,t){var n=ae(e),r=a.callbacksByPath[n].filter(function(e){return!!e});console.log(r.length+" callbacks called"),h.a.forEach(r,function(e){e(t)})},this.set=function(e,t){var n=ae(e);console.log("setting "+n),h.a.set(a.data,n,t);for(var r=n.split("."),o=r.length;o>0;o--)a.callbacksByPath[n]&&a.callCallbacks(r.slice(0,o),t)},this.subscribe=function(e,t){h.a.castArray(e).forEach(function(e){var n=[].concat(Object(v.a)(h.a.castArray(a.callbacksByPath[e])),[t]);a.callbacksByPath[e]=n,a.componentLoadedMap[e]=!1})},this.data=t||{},this.callbacksByPath={},this.componentLoadedMap={},this.db=n},oe=r.a.createContext({}),ie=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(oe.Provider,{value:this.props.store},this.props.children)}}]),t}(r.a.Component),le=function(e,t){return function(n){var o=Object(a.useState)(null),i=Object(ee.a)(o,2),l=i[0],c=i[1],u=h.a.castArray(e),s=function(e){return c(e||{})};return r.a.createElement(oe.Consumer,null,function(e){return null!==l?r.a.createElement(t,Object.assign({},n,e.data,ce(e))):(e.subscribe(u,s),e.load(u),null)})}};function ce(e){return{dispatch:e.dispatch,dispatchDelete:e.dispatchDelete,dispatchUpdate:e.dispatchUpdate}}var ue=function(e){return function(t){return r.a.createElement(oe.Consumer,null,function(n){return r.a.createElement(e,Object.assign({},t,ce(n)))})}},se=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).onColumnNameChange=function(e){var t=[x,n.props.def.id,"cols",n.props.col.id,"name"];n.props.dispatch(t,e.columnName)},n.render=function(){return r.a.createElement(Z.RIEInput,{value:n.props.col.name,change:n.onColumnNameChange,propName:"columnName",validate:h.a.isString})},n}return Object(d.a)(t,e),t}(r.a.Component),de=Object(f.b)(function(e){return{db:e.db}},function(e){return{set:function(t){return function(n){return e(U(t,n))}}}})(ue(se)),fe=Q(J(function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.def,n=e.col,a=e.connectDragSource,o=e.connectDropTarget,i="rTableHead cell read-only"+(e.isOver?"drop-target":"");return o(a(r.a.createElement("div",{className:i,style:{width:n.width}},r.a.createElement(b.MenuProvider,{id:"columnMenu",data:{id:n.id,layoutNb:this.props.layoutNb,def:t},className:"columnMenu menu"},r.a.createElement(de,{col:n,def:t})))))}}]),t}(r.a.Component))),pe=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this,t=this.props,n=(t.db,t.className),a=t.def;return r.a.createElement("div",{className:"rTable "+n,style:{backgroundColor:this.props.def.backgroundColor}},this.props.hideColumnNames||this.props.isField?null:r.a.createElement("div",{className:"rTableHeading"},r.a.createElement("div",{className:"rTableRow"},r.a.createElement("div",{className:"rTableHead cell read-only row-handle",key:"$$actionCell",style:{width:30}}),a.layout&&a.cols?a.layout[this.props.layoutNb].map(function(t,n){var o=a.cols[t];return r.a.createElement(fe,{key:t,col:o,def:a,className:"data-header",columnIndex:n,layoutNb:e.props.layoutNb,onColumnDrop:e.props.onColumnDrop(e.props.db,a)})}):null)),r.a.createElement("div",{className:"rTableBody data-body"},this.props.children))}}]),t}(r.a.PureComponent),he=Object(f.b)(function(e){return{db:e.db}},function(e){return{onColumnDrop:function(t,n){return function(a,r){return e(function(e,t,n,a){var r=Object(y.a)({},t),o=Object(v.a)(r.layout[0]);return o.splice.apply(o,[a,0].concat(Object(v.a)(o.splice(n,1)))),r.layout[0]=o,e.set([x,r.id],r),{type:C,def:r}}(t,n,a,r))}}}})(pe),be=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).render=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(b.MenuProvider,{id:"tableMenu",data:{def:n.props.def,layoutNb:n.props.layoutNb},className:"tableMenu"},r.a.createElement(he,n.props)))},n}return Object(d.a)(t,e),t}(r.a.Component),me=function(e){return r.a.createElement("div",{className:"rTableRow "+e.className},e.children)},ve=function(e){var t=e.cell,n=(e.row,e.col),a=(e.columns,e.attributesRenderer,e.hideLineNumbers),o=(e.selected,e.editing,e.updated,e.style,Object(G.a)(e,["cell","row","col","columns","attributesRenderer","hideLineNumbers","selected","editing","updated","style"])),i=t.attributes||{};if(a&&0===n)return null;var l=t.value;return"function"===typeof l.slice&&"=="===l.slice(0,2)?r.a.createElement("div",Object.assign({},o,i),r.a.createElement(Ue,{id:l.slice(2),hideColumnNames:!1,hideTableName:!0})):r.a.createElement("div",Object.assign({},o,i),e.children)},ye=n(8),ge=n(38),Ee=n.n(ge),we=n(109),je=n.n(we),Oe=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).componentDidMount=function(){var e="storage/"+h.a.castArray("images/"+n.props.id).join("/"),t=Object(ye.a)(Object(ye.a)(n));n.props.db.get(e,function(e){t.setState({downloadUrl:e})})},n.onFilesChange=function(e){n.setState({files:e},function(){console.log(n.state.files)}),n.props.db.stash("images/"+n.props.id,e[0])},n.onFilesError=function(e,t){console.log("error code "+e.code+": "+e.message)},n.state={files:[]},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.state.downloadUrl?r.a.createElement("img",{src:this.state.downloadUrl,alt:"[image]"}):r.a.createElement("div",null,r.a.createElement(je.a,{ref:"files",className:"files-dropzone-gallery",onChange:this.onFilesChange,onError:this.onFilesError,accepts:["image/*"],maxFiles:1,maxFileSize:1e7,minFileSize:0,clickable:!0},this.state.files.length>0?r.a.createElement("div",{className:"files-gallery"},this.state.files.map(function(e){return r.a.createElement("img",{className:"files-gallery-item",src:e.preview.url,key:e.id})})):r.a.createElement("div",null,"Drop images here")))}}]),t}(r.a.Component),Ce=Object(f.b)(function(e){return{db:e.db}},function(e){return{}})(Oe),ke=n(67),Se=n.n(ke),De=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return new RegExp("^(?:[a-z]+:)?//","i").test(this.props.to)?r.a.createElement("a",{href:this.props.to},this.props.children):r.a.createElement("span",{onClick:function(){console.log("link clicked"),e.props.set(X,e.props.to)},className:"link"},this.props.children)}}]),t}(r.a.Component),Me=Object(f.b)(function(e){return{}},function(e){return{set:function(t,n){return e(U(t,n))}}})(De),_e=function(e){var t=Object(a.useState)(!0),n=Object(ee.a)(t,2),o=n[0],i=n[1];return r.a.createElement(r.a.Fragment,null,r.a.createElement("span",{onClick:function(){return i(!o)}},o?"+ ":"- "),r.a.createElement(Me,{to:"/tables/"+e.id},e.name),o?null:r.a.createElement(Ue,Object.assign({},e,{hideTableName:!0})))},xe=Object(f.b)(function(e){return{db:e.db,defs:e.defs}},function(e){return{newTable:function(t,n,a){return function(){return e(K(t,n,a))}}}})(function(e){if(null==e.defs)return null;var t=e.id||h.a.keys(e.defs).find(function(t){return e.defs[t].name===e.name});return t?r.a.createElement(_e,{id:t,name:e.name}):"no table matches"});n(233);window.uuidv1=T.a;var Re=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(r)))).componentDidMount=function(){var e=n.props,t=e.content,a=e.renderMidi;Se.a.renderAbc(n.div,t),a&&Se.a.renderMidi(n.divMidi,t)},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{ref:function(t){return e.div=t}}),r.a.createElement("div",{ref:function(t){return e.divMidi=t},id:"midi"}))}}]),t}(r.a.Component);window.abcLines=function(e,t){},window.abcLine=function(e,t){return r.a.createElement(Re,{content:e+"\n"+t})},window.playAbcLines=function(){},window.abc=function(e){return r.a.createElement(Re,{content:e,renderMidi:!0})},window.backgroundColor=function(e){return function(t){return r.a.createElement("span",{style:{backgroundColor:e}},t)}},window.table=function(e){return r.a.createElement(xe,{name:e})};var Ne=function(e){return new RegExp("\\.+","i").test(e)?e:e+".com"};window.$=function(e){for(var t=window.context,n=t.table,a=t.def,r=t.i,o="",i="",l=!1,c=!1,u=0;u<e.length;u++)"+"===e[u]?l=!0:"-"===e[u]?c=!0:isNaN(e[u])?i+=e[u]:o+=e[u];o=parseInt(o);var s=h.a.keys(a.cols).filter(function(e){return a.cols[e].name===i});return l?n[s][r+o]:c?n[s][r-o]:0===o?n[s][r]:n[s][o-1]},window.meteo=function(e){return"en"===(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{lang:"fr"}).lang?r.a.createElement("iframe",{title:"Environment Canada Weather",width:"287px",height:"191px",src:"https://weather.gc.ca/wxlink/wxlink.html?cityCode=qc-136&lang=e",allowtransparency:"true",frameBorder:"0"}):r.a.createElement("iframe",{title:"M\xe9t\xe9o Environnement Canada",width:"287px",height:"191px",src:"https://meteo.gc.ca/wxlink/wxlink.html?cityCode=qc-136&lang=f",allowtransparency:"true",frameBorder:"0"})},window.test=Ne;var Te=function(e){return Ne(function(e){return new RegExp("^(?:[a-z]+:)?//","i").test(e)?e:"http://"+e}(e))};window.img=function(e){return r.a.createElement("img",{src:e,alt:"[img]"})},window.image=function(e){return e?r.a.createElement(Ce,{id:e}):"Image id required"},window.figure=function(e){return window.center(window.image(e))},window.title=function(e){return r.a.createElement("div",{style:{textAlign:"center",fontWeight:"bold",fontSize:"2rem"}},e)},window.subtitle=function(e){return r.a.createElement("div",{style:{marginLeft:"5%",textDecoration:"underline",fontSize:"1.5rem"}},e)},window.underline=function(e){return r.a.createElement("div",{style:{textDecoration:"underline"}},e)},window.bold=function(e){return r.a.createElement("span",{style:{fontWeight:"bold"}},e)},window.center=function(e){return r.a.createElement("div",{style:{textAlign:"center"}},e)},window.lineThrough=function(e){return r.a.createElement("div",{style:{textDecoration:"line-through"}},e)},window.favicon=function(e){var t=Te(e),n=document.createElement("a");n.href=t;var a=n.origin+"/favicon.ico";return r.a.createElement("img",{width:"14px",height:"14px",src:a,alt:"[ico]"})},window.bookmark=function(e,t){return r.a.createElement(r.a.Fragment,null,window.favicon(e),window.a(e,t))},window.a=function(e,t){var n=Te(e);return r.a.createElement("a",{href:n},t||e)};var Pe={img:{desc:"Renders an image with the html <img> tag.",args:[{name:"src",type:"string",desc:"the url of the image"}]},tex:{desc:"Renders a TeX equation using MathJax",args:[{name:"formula",type:"string",desc:"the TeX formula"}]},image:{desc:"Renders a field to upload or drop an image",args:[{name:"id",type:"string",desc:"the id to reference the image"}]},figure:{desc:"Renders a centered image",args:[{name:"id",type:"string",desc:"the id to reference the figure"}]},$:{desc:"Gets the value at the given spreadsheet reference",args:[{name:"address",type:"string",desc:"the spreadsheet reference"}]},meteo:{desc:"Affiche la meteo d'environment canada",args:[{name:"ville",type:"string",desc:"la ville"},{name:"options",type:"Object",desc:"lang: fr ou en"}]},title:{desc:"",args:[{name:"",type:"",desc:""}]},subtitle:{desc:"",args:[{name:"",type:"",desc:""}]},center:{desc:"",args:[{name:"",type:"",desc:""}]},bold:{desc:"",args:[{name:"",type:"",desc:""}]},underline:{desc:"",args:[{name:"",type:"",desc:""}]},favicon:{desc:"",args:[{name:"",type:"",desc:""}]},bookmark:{desc:"",args:[{name:"",type:"",desc:""}]},a:{desc:"",args:[{name:"",type:"",desc:""}]}};window.help=function(){return r.a.createElement("div",null,h.a.keys(Pe).map(function(e){return r.a.createElement("div",{key:e},window.bold(e)," (",Pe[e].args.map(function(e){return e.name+": "+e.type}).join(", "),") : ",r.a.createElement("br",null)," -> ",Pe[e].desc)}))};var Ke=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).textAreaKeyDown=function(e){console.log(e),8!==e.keyCode&&46!==e.keyCode||n.props.value.length<=1&&n.props.onChange(e.target.value)},n.renderList=function(e){},n.handleChange=n.handleChange.bind(Object(ye.a)(Object(ye.a)(n))),n.renderTextArea=n.renderTextArea.bind(Object(ye.a)(Object(ye.a)(n))),n.onKeyDown=n.onKeyDown.bind(Object(ye.a)(Object(ye.a)(n))),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){this._input.focus()}},{key:"componentDidUpdate",value:function(){this._input.focus()}},{key:"handleChange",value:function(e){this.props.onChange(e.target.value)}},{key:"renderTextArea",value:function(e){var t=this;return r.a.createElement("div",{onKeyDown:this.onKeyDown},r.a.createElement("textarea",Object.assign({},e,{value:this.props.value.slice(1),ref:function(e){t._input=e},onChange:function(e){t.props.onChange("="+e.target.value)},onKeyDown:this.textAreaKeyDown})))}},{key:"onKeyDown",value:function(e){e.stopPropagation()}},{key:"render",value:function(){var e=this,t=this.props,n=t.value,a=t.onKeyDown;return n&&"="===n[0]?this.renderTextArea():r.a.createElement("input",{ref:function(t){e._input=t},className:"data-editor",value:n,onKeyDown:a,onChange:this.handleChange})}}]),t}(a.PureComponent),Ae=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).renderSheet=function(e){return r.a.createElement(be,Object.assign({},e,n.props))},n.generateGrid=function(e){for(var t=n.props,a=t.table,r=t.layoutNb,o=e.layout[r],i=a?Math.max.apply(Math,Object(v.a)(o.map(function(e){return a[e]&&a[e].length||0}))):0,l=function(e){return{value:a[e]&&a[e][s]||""}},c=new Array(o.length).fill({value:""}),u=[],s=0;s<i;++s)u.push(o.map(l));return 0===i&&u.push(c),u=u.map(function(e,t){return[{readOnly:!0,value:t+1}].concat(Object(v.a)(e))})},n.column=function(e){return n.cols()[n.props.def.layout[n.props.layoutNb][e-1]]},n.cols=function(){return(n.props.def||{}).cols},n.valueFromCell=function(e,t,a){var o=void 0,i=void 0;if(0===a&&n.props.hideLineNumbers)return r.a.createElement("span",null);if(0===a&&n.props.isField){var l=n.props.def.layout[n.props.layoutNb],c=n.props.def.cols[l[0]].name;return r.a.createElement("div",null,c)}if(n.cols()&&!e.readOnly){var u=n.column(a);if("document"===u.type&&(i={textAlign:"justify",paddingLeft:"15%",paddingRight:"15%"}),e.value&&"="===e.value[0])try{window.context={table:n.props.table,def:n.props.def,i:t,j:a};var s=eval.call(window,e.value.slice(1));o="object"===typeof s&&null!==s?s:!0===s?"true":!1===s?"false":void 0===s?"undefined":s}catch(d){o=d.toString()}else e.value&&":"===e.value[0]?o=r.a.createElement("button",{onClick:function(){eval.call(window,e.value.slice(1)),n.setState({reload:!n.state.reload})}},e.value.slice(1)):u&&u.type&&(o="link"===u.type&&e.value?r.a.createElement("a",{href:e.value},e.value):"bullet"===u.type?r.a.createElement("span",null,"\u2022"):e.value)}return r.a.createElement("div",{style:i},o||e.value)},n.dataRenderer=function(e){return function(e,t,n){return e.value}},n.cellRenderer=function(e){return r.a.createElement(ve,Object.assign({},e,{hideLineNumbers:n.props.hideLineNumbers}))},n.dataEditor=function(e){return r.a.createElement(Ke,e)},n.handleSelect=function(e){n.setState({selection:Object(y.a)({},e)})},n.keyDown=function(e){if(191===e.keyCode){console.log("creating a sub table");var t=n.state.selection.start,a=t.i,r=t.j,o=T()();n.props.onCellsChanged([{row:a,col:r,value:"=="+o}]),n.props.newTable(n.props.db,n.props.defs,o),e.preventDefault(),e.stopPropagation()}else if(40===e.keyCode){var i=n.props,l=i.table,c=i.layoutNb,u=i.def,s=u.layout[c],d=l?Math.max.apply(Math,Object(v.a)(s.map(function(e){return l[e]&&l[e].length||0}))):0;if(n.state.selection&&n.state.selection.start.i+1>=d){console.log("adding another line");var f=u.layout[c][0];n.props.dispatch([_,n.props.id,f,d],"")}}else if(8===e.keyCode||46===e.keyCode){var p=n.state.selection.start,h=n.state.selection.end;if(p&&(0===p.j||0===h.j)){var b=Math.min(p.i,h.i),m=Math.max(p.i,h.i);n.props.onDeleteLines(n.props.layoutNb,b,m)}}},n.state={reload:!1,selection:{}},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{onKeyDown:this.keyDown},r.a.createElement(z.a,{data:this.generateGrid(this.props.def),sheetRenderer:this.renderSheet,rowRenderer:me,cellRenderer:this.cellRenderer,valueRenderer:this.valueFromCell,dataRenderer:this.dataRenderer(this.props.def),dataEditor:this.dataEditor,onCellsChanged:this.props.onCellsChanged,onSelect:this.handleSelect}))}}]),t}(a.Component),Ie=Object(f.b)(function(e){return{db:e.db,defs:e.defs}},function(e){return{set:function(t){return function(n){return e(U(t,n))}},setDb:function(t,n,a){return e(L(t,n,a))},newTable:function(t,n,a){return e(K(t,n,null,a))}}})(ue(Ae)),Le=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).def=function(){return n.props.defs[n.props.id]},n.onCellsChanged=function(e){return function(t,a){var r=n.props.tables?n.props.tables[n.props.id]:{};""===r&&(r={});var o=n.def();t.concat(a||[]).forEach(function(t){var n=t.cell,a=t.row,i=t.col,l=t.value;t.type;if(!n||"=="!==n.value.slice(0,2)||l){var c=o.layout[e][i-1],u=r[c];if("object"===typeof u){var s=u;s[a]=l||"",r[c]=s}else{var d=Object(v.a)(u||[]);d[a]=l||"",r[c]=d}}}),console.log("onCellsChanged"),console.log(r),n.props.dispatch([_,n.props.id],r),n.setState({data:r})}},n.onDeleteLines=function(e,t,a){var r=n.props.tables?n.props.tables[n.props.id]:{};""===r&&(r={});var o=n.def().layout[e].reduce(function(e,n){return e[n]=[].concat(Object(v.a)(r[n].slice(0,t)),Object(v.a)(r[n].slice(a+1))),e},{});n.props.db.set([_,n.props.id],Object(y.a)({},r,o)),n.setState({data:r})},n.renderDatasheetTable=function(){if(!n.props.tables)return null;var e=n.props.defs[n.props.id];return e.layout.map(function(t,a){var o=!1,i=e.layout[a];if(1===i.length&&n.props.tables&&n.props.tables[n.props.id]){var l=n.props.tables[n.props.id][i[0]];l&&1!==l.length||(o=!0)}return n.props.tables&&n.props.tables[n.props.id]||(o=!0),r.a.createElement(Ie,Object.assign({key:"DatasheetTable"+e.id+a,def:e,table:n.props.tables[n.props.id],onCellsChanged:n.onCellsChanged(a),onDeleteLines:n.onDeleteLines,hideLineNumbers:n.props.hideLineNumbers,isField:o,layoutNb:a},n.props))})},n.onTitleChange=function(e){n.props.db.set([x,n.props.id,"name"],e.title,n.props.set([x,n.props.id,"name"],e.title))},n.onIconChange=function(e){n.props.db.set([x,n.props.id,"icon"],e.icon,n.props.set([x,n.props.id,"icon"],e.icon))},n.onMouseDown=function(e){console.log("table on mouse down")},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return this.def()?r.a.createElement("div",{className:"Table",onMouseDown:this.onMouseDown},this.props.hideTableName?null:r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("span",{className:"title"},r.a.createElement(Z.RIEInput,{value:this.def().name,change:this.onTitleChange,propName:"title",validate:h.a.isString})),r.a.createElement("span",{onClick:function(){e.props.setDb(e.props.db,[x,e.props.id,"del"],"1"),e.props.set(X)("/")},className:"link"},"\ud83d\uddd1")),this.renderDatasheetTable(),this.props.hideTableName?null:"Add field"):(console.log("no def yet"),null)}}]),t}(r.a.Component),Ue=Object(f.b)(function(e){return{db:e.db,defs:e.defs}},function(e){return{set:function(t){return function(n){return e(U(t,n))}},setDb:function(t,n,a){return e(L(t,n,a))}}})(function(e){var t=le("tables."+e.id,Le);return r.a.createElement(t,e)}),Ye=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(b.Menu,{id:"link_screen_menu"},r.a.createElement(b.Item,{onClick:this.props.newLink(this.props.db),data:{test:10}},"new link"),r.a.createElement(b.Item,{onClick:this.props.toggleEditMode},"edit mode"))}}]),t}(r.a.Component),qe=Object(f.b)(function(e){return{db:e.db,defs:e.defs}},function(e){return{toggleEditMode:function(){return e({type:g})},newLink:function(t){return function(){return e(L(t,["items",T()()],{desc:"link"}))}}}})(Ye),Fe=n(110),Be=function(e){return e.if?e.children.props.children:e.children},He=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).smallerX=function(){return Math.min(n.x1,n.x2)},n.largerX=function(){return Math.max(n.x1,n.x2)},n.smallerY=function(){return Math.min(n.y1,n.y2)},n.largerY=function(){return Math.max(n.y1,n.y2)},n.reCalc=function(){var e={};e.left=n.smallerX()+"px",e.top=n.smallerY()+"px",e.width=n.largerX()-n.smallerX()+"px",e.height=n.largerY()-n.smallerY()+"px",n.setState({style:e,hidden:!1})},n.onMouseDown=function(e){n.x1=e.pageX,n.y1=e.pageY,n.x2=e.pageX,n.y2=e.pageY,n.reCalc(),n.props.onMouseDown&&n.props.onMouseDown(e)},n.onMouseMove=function(e){console.log("onMouseMove"),n.state.hidden||(n.x2=e.pageX,n.y2=e.pageY,n.reCalc())},n.onMouseUp=function(e){n.state.hidden||(n.setState({hidden:!0}),n.props.onSelect&&n.props.onSelect(n.smallerX(),n.largerX(),n.smallerY(),n.largerY()))},n.render=function(){return r.a.createElement("div",{id:"selectionDiv",onMouseDown:n.onMouseDown,onMouseUp:n.onMouseUp,onMouseMove:n.onMouseMove},n.props.children,r.a.createElement("div",{id:"selectionRectangle",hidden:n.state.hidden,style:n.state.style}))},n.state={hidden:!0},n.x1=0,n.y1=0,n.x2=0,n.y2=0,n}return Object(d.a)(t,e),t}(r.a.Component),Ve=n(49),Xe=Object(f.b)(function(e){return{db:e.db}})(ue(function(e){var t=Object(a.useState)(!1),n=Object(ee.a)(t,2),o=n[0],i=n[1],l=Object(a.useState)(0),c=Object(ee.a)(l,2),u=c[0],s=c[1],d=Object(a.useState)(0),f=Object(ee.a)(d,2),p=f[0],h=f[1];return r.a.createElement("div",{id:"draggableComponentDiv",onMouseDown:null,onMouseUp:null,onMouseMove:null},r.a.createElement(Ve.DraggableCore,{onStop:function(t,n){var a=n.x-u,r=n.y-p;e.dispatchUpdate(e.path,{x:e.x+a,y:e.y+r}),i(!1)},handle:".dragHandle",grid:[5,5],onStart:function(e,t){i(!0),s(t.x),h(t.y)},disabled:e.disabled},r.a.createElement("div",{className:"draggingDiv"},o?null:e.children)))})),We=Object(f.b)(function(e){return{db:e.db}})(ue(function(e){var t=Object(a.useState)(!1),n=Object(ee.a)(t,2),o=(n[0],n[1]),i=Object(a.useState)(0),l=Object(ee.a)(i,2),c=l[0],u=l[1],s=Object(a.useState)(0),d=Object(ee.a)(s,2),f=d[0],p=d[1];return r.a.createElement(Ve.DraggableCore,{onStop:function(t,n){var a=n.x-c,r=n.y-f,i=f-n.y;e.dispatchUpdate(e.path,{width:e.width+a,height:e.height+i,y:e.y+r}),o(!1)},handle:".resizeHandle",grid:[5,5],onStart:function(e,t){o(!0),u(t.x),p(t.y)},disabled:e.disabled},r.a.createElement("div",{className:"draggingDiv"},e.children))})),ze=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).componentDidMount=function(){n.input.focus()},n.onKeyUp=function(e){13===e.which?n.props.onSelect(n.state.value):27===e.which&&n.props.setCancelled()},n.render=function(){return r.a.createElement("div",{onKeyUp:n.onKeyUp},r.a.createElement(Ee.a,{getItemValue:function(e){return e},items:h.a.values(h.a.mapValues(n.props.defs,"name")),renderItem:function(e,t){return r.a.createElement("div",{style:{background:t?"lightgray":"white"},key:e},e)},ref:function(e){return n.input=e},open:""!==n.state.value,shouldItemRender:h.a.includes,value:n.state.value,onChange:function(e){return n.setState({value:e.target.value})},onSelect:n.props.onSelect}))},n.state={value:""},n}return Object(d.a)(t,e),t}(r.a.Component),Ge=Object(f.b)(function(e){return{defs:e.defs,db:e.db}},function(e){return{addPreview:function(t,n){return e(Y(t,n))}}})(ze),$e={layout:[[""]]};var Je=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).render=function(){return r.a.createElement("div",{onKeyUp:n.onKeyUp},r.a.createElement(Ge,Object.assign({onSelect:n.props.setConfirmed},n.props)))},n}return Object(d.a)(t,e),t}(r.a.Component),Qe=function(e){return r.a.createElement("div",{style:{position:"absolute",width:e.width,height:e.height,maxHeight:e.height,left:e.x,top:e.y}},e.children)},Ze=function(e,t,n,a){return{x:e,y:t,width:n-e,height:a-t}},et=function(e,t,n){return e<n.x||t<n.y||e>n.x+n.width||t>n.y+n.height},tt=function(e,t){return et(e.clientX,e.clientY,t)},nt=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).onSelect=function(e,t,a,r){var o=h.a.keys(n.props.previews).map(function(o){var i=n.props.previews[o],l=Ze(e,a,t,r),c=i.x+i.width/2,u=i.y+i.height/2;return et(c,u,l)?null:o}).filter(function(e){return null!==e});if(o&&0!==o.length)n.setState({selection:o});else{var i=t-e,l=r-a;if(i>20||l>20){var c=T()(),u=T()(),s={id:c,width:i,height:l,x:e,y:a,tableId:u};n.setState({selection:[c],tempPreview:s})}}},n.onMouseDown=function(e){n.state.tempPreview&&tt(e,n.state.tempPreview)?n.setState({selection:[],tempPreview:null}):!n.state.tempPreview&&n.state.selection.length>0&&n.setState({selection:[]})},n.onKeyUp=function(e){46===e.which&&n.state.selection.forEach(function(e){n.props.dispatchDelete([R,e])})},n.onMouseMove=function(e){n.pageX=e.pageX,n.pageY=e.pageY},n.onCopy=function(e){console.log("onCopy"),n.setState({selectionToCopy:n.state.selection})},n.onPaste=function(e){console.log("onPaste");var t=n.state.selectionToCopy;t&&t.map(function(e){var t=n.props.previews[e],a=n.pageX-t.x,r=n.pageY-t.y;n.props.db.get([_,t.tableId],function(o){console.log("Copying "+e),console.log("at "+n.pageX);var i=n.props.defs[t.tableId],l=T()(),c=l,u=Object(y.a)({},i,{name:c});n.props.db.set([x,l],u);var s=[_,l];n.props.setDb(n.props.db,s,o);var d=T()();s=[R,d];var f={id:d,width:t.width,height:t.height,x:a,y:r,tableId:l};n.props.setDb(n.props.db,s,f)}),console.log(Object(ye.a)(Object(ye.a)(n)))})},n.render=function(){return r.a.createElement(He,{onSelect:n.onSelect,onMouseDown:n.onMouseDown,canStart:n.canStartSelection},r.a.createElement("div",{id:"screen",className:n.props.editMode?"editMode":"notEditMode",style:{width:1920,height:1e4,outline:"none"},onMouseUp:n.onMouseUp,onMouseMove:n.onMouseMove,onKeyUp:n.onKeyUp,tabIndex:"0",onPaste:n.onPaste,onCopy:n.onCopy},h.a.keys(n.props.previews).map(function(e){var t=n.props.previews[e],a=n.state.selection.includes(e);return r.a.createElement("div",{key:e},r.a.createElement(Xe,{path:[R,e],x:t.x,y:t.y,disabled:!1},r.a.createElement(We,Object.assign({path:[R,e]},t,{disabled:!1}),r.a.createElement(Qe,Object.assign({},t,{selected:n.state.selection.includes(e)}),r.a.createElement("div",{className:"popover__wrapper"},r.a.createElement("div",{className:"popover__content"},r.a.createElement("div",{className:"flexHandles"},r.a.createElement("div",{className:"clickHandle",onClick:function(){return n.props.set(X,"/tables/".concat(t.tableId))}}),r.a.createElement("div",{className:"dragHandle"}),r.a.createElement("div",{className:"resizeHandle"}))),r.a.createElement("div",{className:a?"selected":"notSelected",style:{}},r.a.createElement(Ue,{id:t.tableId,hideColumnNames:!0,hideTableName:!0,hideLineNumbers:!0})))))))}),n.state.tempPreview?r.a.createElement(Qe,n.state.tempPreview,r.a.createElement(Je,{setCancelled:function(){n.setState({selection:[],tempPreview:null})},setConfirmed:function(e){n.setState({selection:[],tempPreview:null});var t=n.state.tempPreview,a=[R,n.state.tempPreview.id],r=h.a.keys(n.props.defs).filter(function(t){return n.props.defs[t].name===e});if(r&&1===r.length)t.tableId=r[0];else{var o=function(e,t,n){var a=t||M.nextTableName(e),r=n||T()(),o=T()(),i=Object(y.a)({},$e,{name:a,cols:{}});return i.cols[o]={name:"A",id:o},i.layout=[[o]],{id:r,attrs:i}}(n.props.defs,null,n.state.tempPreview.tableId);n.props.dispatch([x,o.id],o.attrs)}n.props.dispatch(a,t)}})):null))},n.state={tempPreview:null,selection:[],selectionToCopy:[]},n}return Object(d.a)(t,e),t}(r.a.Component),at=Object(f.b)(function(e){return{db:e.db,defs:e.defs}},function(e){return{setDb:function(t,n,a){return e(L(t,n,a))},set:function(t,n){return e(U(t,n))},deletePath:function(t,n){return e(function(e,t){return e.unset(t),{type:S.SET,path:["root"].concat(Object(v.a)(h.a.castArray(t))),val:null}}(t,n))},newTable:function(t,n,a,r){return e(K(t,n,a,r))}}})(le("previews",nt)),rt=function(e){var t=Object(a.useState)(0),n=Object(ee.a)(t,2),o=n[0],i=n[1],l=Object(a.useState)(0),c=Object(ee.a)(l,2),u=c[0],s=c[1],d=Object(a.useState)(0),f=Object(ee.a)(d,2),p=f[0],h=f[1];return r.a.createElement(Fe.MapInteraction,e,function(t){var n=t.translation,a=t.scale;e.disabled||(i(n.x),s(n.y),h(a));var l="translate(".concat(o,"px, ").concat(u,"px) scale(").concat(p,")");return r.a.createElement("div",{style:{height:"100%",width:"100%",position:"relative",overflow:"hidden",touchAction:"none",msTouchAction:"none",cursor:"all-scroll",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none"}},r.a.createElement("div",{style:{transform:l,transformOrigin:"0 0 "}},e.children))})},ot=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).state={mapDisabled:!1,x:0,y:0},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return r.a.createElement(Be,{if:!0},r.a.createElement(rt,{showControls:!0,disabled:this.state.mapDisabled},r.a.createElement(r.a.Fragment,null,r.a.createElement(at,null),r.a.createElement(qe,Object.assign({},this.props,{onPaste:this.onPaste})))))}}]),t}(r.a.Component),it=Object(f.b)(function(e){return{db:e.db,editMode:e.ui.editMode,defs:e.defs}},function(e){return{}})(ot),lt=n(111),ct=n.n(lt);function ut(e,t){var n=[],a=ct()(e,n).exec(t);if(!a)return null;for(var r=Object.create(null),o=1;o<a.length;o++)r[n[o-1].name]=void 0!==a[o]?a[o]:void 0;return r}var st={resolve:function(e,t){var n="#"===t[0]?t.slice(1):t;console.log("route: path=".concat(n));var a=!0,r=!1,o=void 0;try{for(var i,l=e[Symbol.iterator]();!(a=(i=l.next()).done);a=!0){var c=i.value,u=ut(c.path,n);if(u){var s=c.action(Object(y.a)({},u,{pathname:n}));if(s)return s}}}catch(p){r=!0,o=p}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}var d=e.filter(function(e){return e.default})[0];if(d)return console.log("No route matches. Showing default route."),d.action({pathname:n});var f=new Error("No route matches this location.");throw f.status=404,f}},dt=function(e){function t(){var e,n;Object(l.a)(this,t);for(var a=arguments.length,o=new Array(a),i=0;i<a;i++)o[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(s.a)(t)).call.apply(e,[this].concat(o)))).render=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"displayFlex",style:{display:"'flex'"}},r.a.createElement(Me,{to:"/"},"Home"),n.props.loading?r.a.createElement("span",null,"Loading..."):r.a.createElement("span",null,"Everything is up to date"),r.a.createElement("span",null)),r.a.createElement("hr",null))},n}return Object(d.a)(t,e),t}(r.a.Component),ft=Object(f.b)(function(e){var t=h.a.get(e.cache.root,V);return{loading:h.a.keys(t).reduce(function(e,n){return e||t[n]},!1)}},function(e){return{}})(dt);function pt(e,t){return"string"===typeof e&&"string"===typeof t?0===e.localeCompare(t,void 0,{sensitivity:"base"}):e===t}var ht={borderRadius:"3px",boxShadow:"0 2px 12px rgba(0, 0, 0, 0.1)",background:"rgba(255, 255, 255, 0)",padding:"2px 0",fontSize:"90%",zIndex:"100",position:"fixed",overflow:"auto",maxHeight:"50%"},bt=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).shouldItemRender=function(e,t){return function(e,t){if(!e)return!1;if(!t)return!0;for(var n=e.length-t.length;n>=0;n--)if(pt(e.slice(n,n+t.length),t))return!0;return!1}(e.label,t)},n.render=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("span",null,"Tables:"),r.a.createElement(Ee.a,{getItemValue:function(e){return e.label},items:(e=n.props.defs,h.a.keys(e).map(function(t){return{value:"/tables/".concat(t),label:e[t].name,id:t}})),renderItem:function(e,t){return r.a.createElement("div",{style:{background:t?"lightgray":"white",cursor:"pointer"},key:e.id},e.label)},shouldItemRender:n.shouldItemRender,value:n.state.value,onChange:function(e){return n.setState({value:e.target.value})},onSelect:function(e,t){return n.props.set(X,t.value)},menuStyle:ht})),r.a.createElement("hr",null));var e},n.state={value:""},n}return Object(d.a)(t,e),t}(r.a.Component),mt=Object(f.b)(function(e){return{defs:e.defs,db:e.db}},function(e){return{addPreview:function(t,n){return e(Y(t,n))},set:function(t,n){return e(U(t,n))}}})(bt),vt=function(e){function t(){return Object(l.a)(this,t),Object(u.a)(this,Object(s.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){this.props.db;return r.a.createElement(b.Menu,{id:"previewMenu"},r.a.createElement(b.Item,{onClick:function(){return null}},"delete"))}}]),t}(r.a.Component),yt=Object(f.b)(function(e){return{db:e.db}},function(e){return{}})(vt),gt=n(33),Et=(n(234),n(39)),wt=n(22),jt={bottom:0,right:0},Ot={backgroundColor:"#e74c3c"},Ct={backgroundColor:"#ffffff",color:"#34495e"},kt="publish",St="new",Dt="settings",Mt="history",_t=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).state={popup:""},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",null,r.a.createElement(Et.a,{open:this.state.popup===kt,modal:!0,closeOnDocumentClick:!0,onClose:function(){return e.setState({popup:""})}},r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"header"},"Publish"),r.a.createElement("div",{className:"content"},"Publish as html. Publish as pdf."))),r.a.createElement(Et.a,{open:this.state.popup===St,modal:!0,closeOnDocumentClick:!0,onClose:function(){return e.setState({popup:""})}},r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"header"},"New table"),r.a.createElement("div",{className:"content"},"New empty table or create from template.",r.a.createElement("br",null),"Recent templates:",r.a.createElement("br",null),"All templates available:",r.a.createElement("br",null),r.a.createElement(Ge,{onSelect:function(t){var n=h.a.keys(e.props.defs).filter(function(n){return e.props.defs[n].name===t});n&&1===n.length&&e.props.db.get([_,n[0]],function(t){var n=T()();e.props.newTable(e.props.db,e.props.defs,null,n,function(a){e.props.setDb(e.props.db,[_,n],t),e.props.set(X,"/tables/".concat(n))})})}})))),r.a.createElement(Et.a,{open:this.state.popup===Dt,modal:!0,closeOnDocumentClick:!0,onClose:function(){return e.setState({popup:""})}},r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"header"},"Settings"),r.a.createElement("div",{className:"content"},"There are currently no settings available."))),r.a.createElement(Et.a,{open:this.state.popup===Mt,modal:!0,closeOnDocumentClick:!0,onClose:function(){return e.setState({popup:""})}},r.a.createElement("div",{className:"modal"},r.a.createElement("div",{className:"header"},"History"),r.a.createElement("div",{className:"content"},"The list of recent tables:"))),r.a.createElement(gt.b,{mainButtonStyles:Ot,position:jt,icon:r.a.createElement(wt.d,null),event:"click"},r.a.createElement(gt.a,{style:Ct,text:"Edit settings",onClick:function(t){e.setState({popup:Dt})}},r.a.createElement(wt.g,null)),r.a.createElement(gt.a,{style:Ct,text:"Recent tables",onClick:function(t){e.setState({popup:Mt})}},r.a.createElement(wt.c,null)),r.a.createElement(gt.a,{style:Ct,text:"Publish",onClick:function(t){e.setState({popup:kt})}},r.a.createElement(wt.f,null)),r.a.createElement(gt.a,{style:Ct,text:"New table",onClick:function(t){e.setState({popup:St})}},r.a.createElement(wt.a,null))))}}]),t}(r.a.Component),xt=Object(f.b)(function(e){return{db:e.db,defs:e.defs}},function(e){return{newTable:function(t,n,a,r,o){return e(K(t,n,a,r,o))},set:function(t,n){return e(U(t,n))},setDb:function(t,n,a){return e(L(t,n,a))}}})(_t);function Rt(e,t){return r.a.createElement("span",{className:"tooltipButton",onClick:t},e)}var Nt=ue(function(e){return r.a.createElement("div",{style:{float:"right",width:"26px"}},r.a.createElement("div",{className:"rightTooltip"},r.a.createElement("div",{className:"appRow"},Rt(r.a.createElement(wt.b,null),function(){e.cache(te,ne)}),Rt(r.a.createElement(wt.e,null),function(){return null}))))}),Tt=[{path:"/index.html",action:function(){return r.a.createElement(it,null)},default:!0},{path:"/",action:function(){return r.a.createElement(it,null)}},{path:"/tables/:id",action:function(e){return r.a.createElement(Ue,e)}}],Pt=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).props.db.get(x,n.props.defsLoaded),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){return this.props.route&&this.props.history.push({hash:this.props.route}),r.a.createElement("div",{className:"app"},r.a.createElement("div",{className:"taskbars"},r.a.createElement(ft,null),r.a.createElement(mt,null)),st.resolve(Tt,this.props.route||this.props.history.location.hash),r.a.createElement(yt,null),r.a.createElement(xt,null),r.a.createElement(Nt,null),r.a.createElement(H,{db:this.props.db}),r.a.createElement(F,{db:this.props.db}))}}]),t}(r.a.Component),Kt=Object(f.b)(function(e){return{db:e.db,route:h.a.get(e.cache.root,X),history:e.history}},function(e){return{defsLoaded:function(t){return e(function(e){return console.log("Loading defs"),{type:w,payload:e}}(t))}}})(Pt),At=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(u.a)(this,Object(s.a)(t).call(this,e))).state={hasError:!1},n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidCatch",value:function(e,t){console.error(e,t)}},{key:"render",value:function(){return this.state.hasError?r.a.createElement("h1",null,"Something went wrong."):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{hasError:!0}}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var It=n(37),Lt=n(114),Ut=n(50),Yt=n.n(Ut);function qt(e){return h.a.castArray(e).join(".")}var Ft=function e(){var t=this;Object(l.a)(this,e),this.stash=function(e,t){return null},this.get=function(e,t){Yt.a.get("http://localhost:8000/prod_db/"+qt(e)).then(function(e){t&&t(e.data)}).catch(function(e){console.log(e)}).finally(function(){})},this.set=function(e,t,n){Yt.a.put("http://localhost:8000/prod_db/"+qt(e),{data:t},{headers:{"Content-Type":"application/json"}}).then(function(e){n&&n()}).catch(function(e){console.log(e)}).finally(function(){})},this.unset=function(e,t){Yt.a.delete("http://localhost:8000/prod_db/"+qt(e)).then(function(e){t&&t()}).catch(function(e){console.log(e)}).finally(function(){})},this.update=function(e,n){h.a.keys(n).forEach(function(a){t.set(qt(e)+"."+a,n[a],null)})}},Bt=n(112),Ht={editMode:!1};function Vt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ht;return(arguments.length>1?arguments[1]:void 0).type===g?Object.assign({},e,{editMode:!e.editMode}):e}function Xt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{root:{}},t=arguments.length>1?arguments[1]:void 0;if(t.type===S.SET){console.log("Cache: Set: path:".concat(t.path));var n=t.path.constructor===Array?t.path:[t.path];return Object(Bt.a)(e).setIn(n,t.val).toJS()}return t.type===S.PUSH||t.type===S.NEW||t.type===S.LIST||(t.type,S.DEL),e}function Wt(e){return h.a.keys(e).reduce(function(t,n){var a=e[n];return a.id=n,t[n]=a,t},{})}function zt(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(t.type===w){var n=Wt(t.payload);return h.a.keys(t.payload).reduce(function(e,t){return n[t].del?e:(e[t]=Object(y.a)({},n[t],{cols:Wt(n[t].cols)}),e)},{})}if(t.type===j)return Object.keys(e).filter(function(e){return e!==t.id}).reduce(function(t,n){return Object(y.a)({},t,Object(m.a)({},n,e[n]))},{});if(t.type===k)return t.defs;if(t.type===C){var a=Object(y.a)({},e);return a[t.def.name]=t.def,a}if(t.type===O);else if(t.type===E){var r=Object(y.a)({},e);return r[t.name]=t.def,r}return e}var Gt=Object(It.createStore)(function(e,t){return void 0===e&&(e={db:new Ft,history:Object(Lt.a)()}),Object(y.a)({},e,{ui:Vt(e.ui,t),defs:zt(e.defs,t),cache:Xt(e.cache,t)})}),$t=n(113),Jt=n.n($t),Qt=n(68),Zt=h.a.isEmpty(Qt)?new re({},new Ft):new re(Qt);i.a.render(r.a.createElement(ie,{store:Zt},r.a.createElement(f.a,{store:Gt},r.a.createElement($.DragDropContextProvider,{backend:Jt.a},r.a.createElement(Be,{if:!1},r.a.createElement(At,null,r.a.createElement(Kt,null)))))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},35:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,r=n(11),o=(a=r)&&a.__esModule?a:{default:a};var i={readOnly:o.default.bool,key:o.default.string,className:o.default.string,component:o.default.oneOfType([o.default.element,o.default.func]),forceComponent:o.default.bool,disableEvents:o.default.bool,colSpan:o.default.number,rowSpan:o.default.number,width:o.default.oneOfType([o.default.number,o.default.string]),overflow:o.default.oneOf(["wrap","nowrap","clip"]),dataEditor:o.default.func,valueViewer:o.default.func};t.default=i},53:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),o=n(0),i=u(o),l=u(n(11)),c=u(n(35));function u(e){return e&&e.__esModule?e:{default:e}}var s=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.PureComponent),r(t,[{key:"render",value:function(){var e=this.props,t=e.cell,n=e.row,r=e.col,o=e.attributesRenderer,l=e.className,c=e.style,u=e.onMouseDown,s=e.onMouseOver,d=e.onDoubleClick,f=e.onContextMenu,p=t.colSpan,h=t.rowSpan,b=o?o(t,n,r):{};return i.default.createElement("td",a({className:l,onMouseDown:u,onMouseOver:s,onDoubleClick:d,onContextMenu:f,colSpan:p,rowSpan:h,style:c},b),this.props.children)}}]),t}();t.default=s,s.propTypes={row:l.default.number.isRequired,col:l.default.number.isRequired,cell:l.default.shape(c.default).isRequired,selected:l.default.bool,editing:l.default.bool,updated:l.default.bool,attributesRenderer:l.default.func,onMouseDown:l.default.func.isRequired,onMouseOver:l.default.func.isRequired,onDoubleClick:l.default.func.isRequired,onContextMenu:l.default.func.isRequired,className:l.default.string,style:l.default.object},s.defaultProps={selected:!1,editing:!1,updated:!1,attributesRenderer:function(){}}},54:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(0),o=c(r),i=c(n(11)),l=c(n(35));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleChange=n.handleChange.bind(n),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.PureComponent),a(t,[{key:"componentDidMount",value:function(){this._input.focus()}},{key:"handleChange",value:function(e){this.props.onChange(e.target.value)}},{key:"render",value:function(){var e=this,t=this.props,n=t.value,a=t.onKeyDown;return o.default.createElement("input",{ref:function(t){e._input=t},className:"data-editor",value:n,onChange:this.handleChange,onKeyDown:a})}}]),t}();t.default=u,u.propTypes={value:i.default.node.isRequired,row:i.default.number.isRequired,col:i.default.number.isRequired,cell:i.default.shape(l.default),onChange:i.default.func.isRequired,onCommit:i.default.func.isRequired,onRevert:i.default.func.isRequired,onKeyDown:i.default.func.isRequired}},55:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(0),o=c(r),i=c(n(11)),l=c(n(35));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.PureComponent),a(t,[{key:"render",value:function(){var e=this.props.value;return o.default.createElement("span",{className:"value-viewer"},e)}}]),t}();t.default=u,u.propTypes={row:i.default.number.isRequired,col:i.default.number.isRequired,cell:i.default.shape(l.default),value:i.default.node.isRequired}},68:function(e){e.exports={defs:{"03b41dc1-7f14-11e9-8af6-659745a3bbcd":{layout:[["04598580-7f14-11e9-8af6-659745a3bbcd"]],name:"table1",cols:{"04598580-7f14-11e9-8af6-659745a3bbcd":{name:"A",id:"04598580-7f14-11e9-8af6-659745a3bbcd"}}},"29463051-7f14-11e9-8af6-659745a3bbcd":{layout:[["29d43f80-7f14-11e9-8af6-659745a3bbcd","62742e20-7f16-11e9-8870-4bca3fb8e091"],["95d43030-7f16-11e9-b683-7bd579445e82"]],name:"table2",cols:{"29d43f80-7f14-11e9-8af6-659745a3bbcd":{name:"A",id:"29d43f80-7f14-11e9-8af6-659745a3bbcd"},"62742e20-7f16-11e9-8870-4bca3fb8e091":{name:"B",type:"",id:"62742e20-7f16-11e9-8870-4bca3fb8e091"},"95d43030-7f16-11e9-b683-7bd579445e82":{name:"C",type:""}},id:"29463051-7f14-11e9-8af6-659745a3bbcd"},"32a88851-7f14-11e9-8af6-659745a3bbcd":{layout:[["32ebf9f0-7f14-11e9-8af6-659745a3bbcd"]],name:"table3",cols:{"32ebf9f0-7f14-11e9-8af6-659745a3bbcd":{name:"A",id:"32ebf9f0-7f14-11e9-8af6-659745a3bbcd"}}},"dc3994c1-7f16-11e9-9861-c9b2444f4d10":{layout:[["dcc755d0-7f16-11e9-9861-c9b2444f4d10"]],name:"bookmarks",cols:{"dcc755d0-7f16-11e9-9861-c9b2444f4d10":{name:"A",id:"dcc755d0-7f16-11e9-9861-c9b2444f4d10"}}},"":{layout:[["dcc755d0-7f16-11e9-9861-c9b2444f4d10"],["ed077dd0-7f16-11e9-9861-c9b2444f4d10"]],name:"table4",cols:{"dcc755d0-7f16-11e9-9861-c9b2444f4d10":{name:"A",id:"dcc755d0-7f16-11e9-9861-c9b2444f4d10"},"ed077dd0-7f16-11e9-9861-c9b2444f4d10":{name:"B",type:""}}}},previews:{"03b41dc0-7f14-11e9-8af6-659745a3bbcd":{id:"03b41dc0-7f14-11e9-8af6-659745a3bbcd",width:218,height:47,x:754,y:69,tableId:"03b41dc1-7f14-11e9-8af6-659745a3bbcd"},"29463050-7f14-11e9-8af6-659745a3bbcd":{id:"29463050-7f14-11e9-8af6-659745a3bbcd",width:156,height:105,x:41,y:91,tableId:"29463051-7f14-11e9-8af6-659745a3bbcd"},"32a88850-7f14-11e9-8af6-659745a3bbcd":{id:"32a88850-7f14-11e9-8af6-659745a3bbcd",width:612,height:72,x:1018,y:86,tableId:"32a88851-7f14-11e9-8af6-659745a3bbcd"},"dc3994c0-7f16-11e9-9861-c9b2444f4d10":{id:"dc3994c0-7f16-11e9-9861-c9b2444f4d10",width:131,height:471,x:33,y:291,tableId:"dc3994c1-7f16-11e9-9861-c9b2444f4d10"}},tables:{"03b41dc1-7f14-11e9-8af6-659745a3bbcd":{"04598580-7f14-11e9-8af6-659745a3bbcd":["=title('DEMO')"]},"32a88851-7f14-11e9-8af6-659745a3bbcd":{"32ebf9f0-7f14-11e9-8af6-659745a3bbcd":["=backgroundColor('yellow')('Note: This is only a demo, every modification you make will not be saved. You must either install the application or setup a database. Since this is totally free software, no free online storing server is provided, but you can easily set one up with firebase.')"]},"29463051-7f14-11e9-8af6-659745a3bbcd":{"29d43f80-7f14-11e9-8af6-659745a3bbcd":["x","y","x+y ="],"62742e20-7f16-11e9-8870-4bca3fb8e091":["10","20","=$('B1')+$('B2')"],"95d43030-7f16-11e9-b683-7bd579445e82":["=bold('It can be used for calculating')"]},"dc3994c1-7f16-11e9-9861-c9b2444f4d10":{"dcc755d0-7f16-11e9-9861-c9b2444f4d10":["Bookmarks"]}}}},71:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(0),o=l(r),i=l(n(11));function l(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.PureComponent),a(t,[{key:"render",value:function(){return o.default.createElement("table",{className:this.props.className},o.default.createElement("tbody",null,this.props.children))}}]),t}();c.propTypes={className:i.default.string,data:i.default.array.isRequired},t.default=c},72:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),r=n(0),o=c(r),i=c(n(11)),l=c(n(35));function c(e){return e&&e.__esModule?e:{default:e}}var u=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.PureComponent),a(t,[{key:"render",value:function(){return o.default.createElement("tr",null,this.props.children)}}]),t}();u.propTypes={row:i.default.number.isRequired,cells:i.default.arrayOf(i.default.shape(l.default)).isRequired},t.default=u},73:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.TAB_KEY=9,t.ENTER_KEY=13,t.ESCAPE_KEY=27,t.LEFT_KEY=37,t.UP_KEY=38,t.RIGHT_KEY=39,t.DOWN_KEY=40,t.DELETE_KEY=46,t.BACKSPACE_KEY=8},74:function(e,t,n){"use strict";function a(e,t,n,a){var r=a(e,t,n);return null===r||"undefined"===typeof r?"":r}Object.defineProperty(t,"__esModule",{value:!0}),t.renderValue=a,t.renderData=function(e,t,n,r,o){var i=o?o(e,t,n):null;return null===i||"undefined"===typeof i?a(e,t,n,r):i}}},[[115,1,2]]]);
//# sourceMappingURL=main.19e92ecf.chunk.js.map